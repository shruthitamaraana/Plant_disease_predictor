<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plant Disease Classification</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <!-- (Updated) Font changed to Poppins -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- (New) Background Animation Container -->
    <div class="background-icons">
        <div class="icon"></div>
        <div class="icon"></div>
        <div class="icon"></div>
        <div class="icon"></div>
        <div class="icon"></div>
        <div class="icon"></div>
        <div class="icon"></div>
        <div class="icon"></div>
        <div class="icon"></div>
        <div class="icon"></div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay">
        <div class="spinner"></div>
        <p>Classifying, please wait...</p>
    </div>

    <!-- Custom Alert Container -->
    <div id="alert-container"></div>

    <div class="container">
        <header>
            <h1>Plant Disease Classification</h1>
            <p>Upload a clear image of a plant leaf, and our AI will analyze it for common diseases, providing you with instant results.</p>
        </header>

        <main>
            <div class="card">
                <!-- Flash Messages -->
                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        {% for category, message in messages %}
                            <div class="flash-message {{ category }}">{{ message }}</div>
                        {% endfor %}
                    {% endif %}
                {% endwith %}

                <form id="upload-form" action="/predict" method="post" enctype="multipart/form-data">
                    <div class="form-group">
                        <label for="file-upload" class="file-upload-label">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-cloud-arrow-up-fill" viewBox="0 0 16 16" style="margin-right: 8px;">
                                <path d="M8 2a5.53 5.53 0 0 0-3.594 1.342c-.766.66-1.321 1.52-1.464 2.383C1.266 6.095 0 7.555 0 9.318 0 11.366 1.708 13 3.781 13h8.906C14.502 13 16 11.57 16 9.773c0-1.636-1.242-2.969-2.834-3.194C12.923 3.999 10.69 2 8 2zm2.354 5.146a.5.5 0 0 1-.708.708L8.5 6.707V10.5a.5.5 0 0 1-1 0V6.707L6.354 7.854a.5.5 0 1 1-.708-.708l2-2a.5.5 0 0 1 .708 0l2 2z"/>
                            </svg>
                            Choose an Image
                        </label>
                        <input id="file-upload" type="file" name="file" onchange="updateFileName(this)">
                        <span id="file-name" class="file-name-display">No file chosen</span>
                        <p class="form-hint">For best results, please upload a clear, close-up image of a single plant leaf.</p>
                    </div>
                    <div class="button-group">
                        <button type="submit" class="btn btn-primary">Classify</button>
                        <a href="/clear" class="btn btn-secondary">Clear</a>
                    </div>
                </form>
            </div>

            <!-- (New) "How It Works" Section -->
            <div class="how-it-works">
                <h2>How It Works</h2>
                <div class="steps-container">
                    <div class="step">
                        <div class="step-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-image" viewBox="0 0 16 16">
                                <path d="M6.002 5.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"/>
                                <path d="M2.002 1a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2h-12zm12 1a1 1 0 0 1 1 1v6.5l-3.777-1.947a.5.5 0 0 0-.577.093l-3.71 3.71-2.66-1.772a.5.5 0 0 0-.63.062L1.002 12V3a1 1 0 0 1 1-1h12z"/>
                            </svg>
                        </div>
                        <h3>1. Upload Image</h3>
                        <p>Select a clear photo of a plant leaf from your device.</p>
                    </div>
                    <div class="step">
                        <div class="step-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-cpu" viewBox="0 0 16 16">
                                <path d="M5 0a.5.5 0 0 1 .5.5V2h1V.5a.5.5 0 0 1 1 0V2h1V.5a.5.5 0 0 1 1 0V2h1V.5a.5.5 0 0 1 1 0V2A2.5 2.5 0 0 1 14 4.5h1.5a.5.5 0 0 1 0 1H14v1h1.5a.5.5 0 0 1 0 1H14v1h1.5a.5.5 0 0 1 0 1H14v1h1.5a.5.5 0 0 1 0 1H14A2.5 2.5 0 0 1 11.5 14v1.5a.5.5 0 0 1-1 0V14h-1v1.5a.5.5 0 0 1-1 0V14h-1v1.5a.5.5 0 0 1-1 0V14h-1v1.5a.5.5 0 0 1-1 0V14A2.5 2.5 0 0 1 2 11.5H.5a.5.5 0 0 1 0-1H2v-1H.5a.5.5 0 0 1 0-1H2v-1H.5a.5.5 0 0 1 0-1H2v-1H.5a.5.5 0 0 1 0-1H2A2.5 2.5 0 0 1 4.5 2V.5A.5.5 0 0 1 5 0zm-.5 3A1.5 1.5 0 0 0 3 4.5v7A1.5 1.5 0 0 0 4.5 13h7a1.5 1.5 0 0 0 1.5-1.5v-7A1.5 1.5 0 0 0 11.5 3h-7zM5 6.5A1.5 1.5 0 0 1 6.5 5h3A1.5 1.5 0 0 1 11 6.5v3A1.5 1.5 0 0 1 9.5 11h-3A1.5 1.5 0 0 1 5 9.5v-3zM6.5 6a.5.5 0 0 0-.5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 0-.5-.5h-3z"/>
                            </svg>
                        </div>
                        <h3>2. AI Analysis</h3>
                        <p>Our system analyzes the image using a deep learning model.</p>
                    </div>
                    <div class="step">
                        <div class="step-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-file-earmark-medical" viewBox="0 0 16 16">
                                <path d="M7.5 5.5a.5.5 0 0 0-1 0v.634l-.549-.317a.5.5 0 1 0-.5.866L6 7l-.549.317a.5.5 0 1 0 .5.866l.549-.317V8.5a.5.5 0 1 0 1 0v-.634l.549.317a.5.5 0 1 0 .5-.866L8 7l.549-.317a.5.5 0 1 0-.5-.866l-.549.317V5.5zm-2 4.5a.5.5 0 0 0 0 1h5a.5.5 0 0 0 0-1h-5zm0 2a.5.5 0 0 0 0 1h5a.5.5 0 0 0 0-1h-5z"/>
                                <path d="M14 14V4.5L9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2zM9.5 3A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5v2z"/>
                            </svg>
                        </div>
                        <h3>3. Get Results</h3>
                        <p>Receive an instant diagnosis and information about the disease.</p>
                    </div>
                </div>
            </div>

            <!-- Results Section -->
            {% if prediction %}
            <div class="results-card">
                <div class="results-grid">
                    <!-- Left Column: Image -->
                    <div class="image-container">
                        <h3>Uploaded Image</h3>
                        <img src="{{ image_path }}" alt="Uploaded Plant Leaf">
                    </div>

                    <!-- Right Column: Predictions -->
                    <div class="prediction-container">
                        <h3>Prediction Result</h3>
                        <div class="main-prediction">
                            <strong>{{ prediction }}</strong>
                            <span>(Confidence: {{ confidence }})</span>
                        </div>

                        <!-- Display Healthy Info -->
                        {% if healthy_info %}
                        <div class="healthy-info">
                            <h4>
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-shield-check" viewBox="0 0 16 16">
                                    <path d="M5.338 1.59a61.44 61.44 0 0 0-2.837.856.481.481 0 0 0-.328.39c-.554 4.157.726 7.19 2.253 9.188a10.725 10.725 0 0 0 2.287 2.233c.346.244.652.42.893.533.12.057.218.095.293.118a.55.55 0 0 0 .101.025.615.615 0 0 0 .1-.025c.076-.023.174-.06.294-.118.24-.113.547-.29.893-.533a10.726 10.726 0 0 0 2.287-2.233c1.527-1.997 2.807-5.031 2.253-9.188a.48.48 0 0 0-.328-.39c-.95-1.095-2.5-2.09-4.042-2.35a48.778 48.778 0 0 0-1.433-.211 1.15 1.15 0 0 0-.196 0 48.778 48.778 0 0 0-1.433.211c-.397.057-.803.149-1.21.272zM10.854 5.146a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 1 1 .708-.708L7.5 7.793l2.646-2.647a.5.5 0 0 1 .708 0z"/>
                                </svg>
                                {{ healthy_info.title }}
                            </h4>
                            <p>{{ healthy_info.description }}</p>
                        </div>
                        {% endif %}

                        <!-- Display Disease Info -->
                        {% if disease_info %}
                        <div class="disease-info">
                            <h4>
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-exclamation-triangle-fill" viewBox="0 0 16 16">
                                    <path d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/>
                                </svg>
                                Disease Details
                            </h4>
                            <p><strong>Description:</strong> {{ disease_info.description }}</p>
                            <p><strong>Treatment:</strong> {{ disease_info.treatment }}</p>
                            <a href="{{ disease_info.link }}" target="_blank" class="learn-more-link">
                                Learn More
                            </a>
                        </div>
                        {% endif %}


                        <div class="top-predictions">
                            <h4>Top Predictions</h4>
                            <ul>
                                {% for p in top_3 %}
                                <li>{{ p.class }} <span>{{ p.confidence }}</span></li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}

        </main>
    </div>

    <script>
        // This function ensures the loading overlay is hidden as soon as the page is visible.
        window.addEventListener('pageshow', function(event) {
            document.getElementById('loading-overlay').style.display = 'none';
        });

        function updateFileName(input) {
            const fileNameDisplay = document.getElementById('file-name');
            if (input.files.length > 0) {
                fileNameDisplay.textContent = input.files[0].name;
            } else {
                fileNameDisplay.textContent = 'No file chosen';
            }
        }

        // Function to show custom alerts
        function showAlert(message, type = 'error') {
            const alertContainer = document.getElementById('alert-container');
            const alertDiv = document.createElement('div');
            alertDiv.className = `custom-alert custom-alert-${type}`;
            alertDiv.textContent = message;

            alertContainer.appendChild(alertDiv);

            // Trigger fade in animation
            setTimeout(() => {
                alertDiv.classList.add('show');
            }, 10);

            // Set timeout to remove the alert
            setTimeout(() => {
                alertDiv.classList.remove('show');
                alertDiv.addEventListener('transitionend', () => alertDiv.remove());
            }, 4000);
        }

        // Form submission listener
        document.getElementById('upload-form').addEventListener('submit', function(event) {
            const fileInput = document.getElementById('file-upload');
            if (fileInput.files.length === 0) {
                event.preventDefault(); // Stop the form from submitting
                showAlert('Please select an image to classify.');
            } else {
                document.getElementById('loading-overlay').style.display = 'flex';
            }
        });
    </script>
</body>
</html>

